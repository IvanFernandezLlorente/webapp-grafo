function array(...a){return Array.prototype.slice.call(a)}function array_key_exists(a,b){return!!(b&&(b.constructor===Array||b.constructor===Object))&&a in b}function array_keys(a,b,c){var d=[],c=!!c,e=!0,f=0;for(var g in a)e=!0,null!=b&&(c&&a[g]!==b?e=!1:a[g]!=b&&(e=!1)),e&&(d[f]=g,f++);return d}function array_values(a){var b=[],c="";if(a&&"object"==typeof a&&a.change_key_case)return a.values();for(c in a)b[b.length]=a[c];return b}function in_array(a,b,c){var d,e=!1,c=!!c;for(d in b)if(c&&b[d]===a||!c&&b[d]==a){e=!0;break}return e}function sizeof(a,b){return count(a,b)}function count(a,b){var c,d=0;for(c in"COUNT_RECURSIVE"==b&&(b=1),1!=b&&(b=0),a)d++,1==b&&a[c]&&(a[c].constructor===Array||a[c].constructor===Object)&&(d+=count(a[c],1));return d}function explode(a,b,c){if(2>arguments.length||"undefined"==typeof arguments[0]||"undefined"==typeof arguments[1])return null;if(""===a||!1===a||null===a)return!1;if("function"==typeof a||"object"==typeof a||"function"==typeof b||"object"==typeof b)return{0:""};if(!0===a&&(a="1"),!c)return b.toString().split(a.toString());var d=b.toString().split(a.toString()),e=d.splice(0,c-1),f=d.join(a.toString());return e.push(f),e}function implode(a,b){return b instanceof Array?b.join(a):b}function join(a,b){return implode(a,b)}function split(a,b){return explode(a,b)}function str_replace(a,b,c){for(var d=a,e=b,g=c,h=is_array(e),k=is_array(g),d=[].concat(d),e=[].concat(e),l=(g=[].concat(g)).length;j=0,l--;)for(;g[l]=g[l].split(d[j]).join(h?e[j]||"":e[0]),++j in d;);return k?g:g[0]}function strlen(a){return(""+a).length}function strpos(a,b,c){var d=a.indexOf(b,c);return!!(0<=d)&&d}function strrpos(a,b,c){var d=a.lastIndexOf(b,c);return!!(0<=d)&&d}function strtolower(a){return a.toLowerCase()}function strtoupper(a){return a.toUpperCase()}function substr(a,b,c){return 0>b&&(b+=a.length),null==c?c=a.length:0>c?c+=a.length:c+=b,c<b&&(c=b),a.substring(b,c)}function trim(a,b){if(!a)return"";var c=b?b.replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^\:])/g,"$1"):" \n\r\t\f\x0B\xA0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u200B\u2028\u2029\u3000";for(var d=0;d<a.length;d++)if(-1===c.indexOf(a.charAt(d))){a=a.substring(d);break}for(d=a.length-1;0<=d;d--)if(-1===c.indexOf(a.charAt(d))){a=a.substring(0,d+1);break}return-1===c.indexOf(a.charAt(0))?a:""}function wordwrap(a,b,d,e){var f,g,h,k,n,o=b,m=e;if(1>o)return a;for(f=-1,h=(n=a.split("\n")).length;++f<h;n[f]+=k)for(k=n[f],n[f]="";k.length>o;n[f]+=k.slice(0,g)+((k=k.slice(g)).length?d:""))g=2==m||(g=k.slice(0,o+1).match(/\S*(\s)?$/))[1]?o:g.input.length-g[0].length||1==m&&o||g.input.length+(g=k.slice(o).match(/^\S*/)).input.length;return n.join("\n")}function is_string(a){return"string"==typeof a}function ord(a){return a.charCodeAt(0)}function array_unique(a){var b,c,d,e=a;for(c=e.length;c;)for(b=--c;0<b;)if(e[c]===e[--b]){for(d=b;--b&&e[c]===e[b];);c-=e.splice(b+1,d-b).length}return e}function print_r(a,b){var c="",d=(a,b,c,f)=>{0<b&&b++;var g=e(c*b,f),h=e(c*(b+1),f),i="";if(a instanceof Array||a instanceof Object){for(var k in i+="Array\n"+g+"(\n",a)i+=a[k]instanceof Array||a[k]instanceof Object?h+"["+k+"] => "+d(a[k],b+1,c,f):h+"["+k+"] => "+a[k]+"\n";i+=g+")\n"}else i=a.toString();return i},e=(a,b)=>{for(var c="",d=0;d<a;d++)c+=b;return c};return c=d(a,0,4," "),!0===b?c:(document.write("<pre>"+c+"</pre>"),!0)}function is_array(a){return a instanceof Array}function BibTex(a){for(option in"undefined"==typeof a&&(a={}),this.data,this.content,this._delimiters,this.warnings,this._options,this.rtfstring,this.htmlstring,this.allowedEntryTypes,this.authorstring,this._delimiters={'"':"\"","{":"}"},this.data=[],this.content="",this.warnings=[],this._options={stripDelimiter:!0,validate:!0,unwrap:!1,wordWrapWidth:!1,wordWrapBreak:"\n",wordWrapCut:0,removeCurlyBraces:!1,extractAuthors:!0},a)test=this.setOption(option,a[option]),this.isError(test);this.rtfstring="AUTHORS, \"{\b TITLE}\", {i JOURNAL}, YEAR",this.htmlstring="AUTHORS, \"<strong>TITLE</strong>\", <em>JOURNAL</em>, YEAR<br />",this.allowedEntryTypes=array("article","book","booklet","confernce","inbook","incollection","inproceedings","manual","masterthesis","misc","phdthesis","proceedings","techreport","unpublished"),this.authorstring="VON LAST, JR, FIRST"}BibTex.prototype={setOption(a,b){return ret=!0,array_key_exists(a,this._options)?this._options[a]=b:ret=this.raiseError("Unknown option "+a),ret},parse(){this.warnings=[],this.data=[];for(var a=!0,b=0,c=!1,d="",e="",f="",g=0;g<strlen(this.content);g++){if(d=substr(this.content,g,1),0==b||"@"!=d||this._checkAt(f)||(this._generateWarning("WARNING_MISSING_END_BRACE","",f),d="}",g--),0==b&&"@"==d)c=!0;else if(c&&"{"==d&&"\\"!=e)b++;else if(c&&"}"==d&&"\\"!=e&&(b--,0>b&&(a=!1),0==b)){c=!1;var h=this._parseEntry(f);h&&(this.data[this.data.length]=h),f=""}c&&(f+=d),e=d}if(1==b&&(h=this._parseEntry(f),h?(this.data[this.data.length]=h,f="",b=0):a=!1),0!=b&&(a=!1),this._options.validate){let a=[];for(var g=0;g<this.data.length;g++)a[a.length]=this.data[g].cite;let b=array_unique(a);if(a.length!=sizeof(b)){notuniques=[];for(var g=0;g<a.length;g++)""==b[g]&&(notuniques[notuniques.length]=a[g]);this._generateWarning("WARNING_MULTIPLE_ENTRIES",implode(",",notuniques))}}return a?(this.content="",!0):this.raiseError("Unbalanced parenthesis")},_parseEntry:function(a){var b="";this._options.validate&&(b=a);var c={};if("@string"==strtolower(substr(a,0,7)))this._options.validate&&this._generateWarning("STRING_ENTRY_NOT_YET_SUPPORTED","",a+"}");else if("@preamble"==strtolower(substr(a,0,9)))this._options.validate&&this._generateWarning("PREAMBLE_ENTRY_NOT_YET_SUPPORTED","",a+"}");else{for(let d,e,f,g;!1!==strrpos(a,"=");){for(d=strrpos(a,"="),e=!0,"\\"==substr(a,d-1,1)&&(e=!1),e&&(e=this._checkEqualSign(a,d));!e;)substring=substr(a,0,d),d=strrpos(substring,"="),e=!0,"\\"==substr(a,d-1,1)&&(e=!1),e&&(e=this._checkEqualSign(a,d));f=trim(substr(a,d+1)),a=substr(a,0,d),","==substr(f,strlen(f)-1,1)&&(f=substr(f,0,-1)),this._options.validate&&this._validateValue(f,b),this._options.stripDelimiter&&(f=this._stripDelimiter(f)),this._options.unwrap&&(f=this._unwrap(f)),this._options.removeCurlyBraces&&(f=this._removeCurlyBraces(f)),d=strrpos(a,","),g=strtolower(trim(substr(a,d+1))),c[g]=f,a=substr(a,0,d)}var d=a.split("{");c.cite=trim(d[1]),c.entryType=strtolower(trim(d[0])),"@"==c.entryType.substring(0,1)&&(c.entryType=substr(c.entryType,1)),this._options.validate&&!this._checkAllowedEntryType(c.entryType)&&this._generateWarning("WARNING_NOT_ALLOWED_ENTRY_TYPE",c.entryType,a+"}"),in_array("author",array_keys(c))&&this._options.extractAuthors&&(c.author=this._extractAuthors(c.author)),in_array("editor",array_keys(c))&&this._options.extractAuthors&&(c.editor=this._extractAuthors(c.editor))}return c},_checkEqualSign:function(a,b){var c=!0,d=strlen(a),e=0;let f,g;for(var h=d-1;h>=b;h--)f=substr(a,h-1,1),g=substr(a,h,1),"{"==g&&"\\"!=f&&e++,"}"==g&&"\\"!=f&&e--;0!=e&&(c=!1);let k,l;if(c&&(k=trim(a),l=substr(k,strlen(k)-1,1),","==l&&(l=substr(k,strlen(k)-2,1)),"\""==l)){c=!1,found=0;for(var h=d;h>=b;h--)if(f=substr(a,h-1,1),g=substr(a,h,1),"\""==g&&"\\"!=f&&found++,2==found){c=!0;break}}return c},_checkAllowedEntryType:function(a){return in_array(a,this.allowedEntryTypes)},_checkAt:function(a){var b=!1,c=array_keys(this._delimiters),d=array_values(this._delimiters);if(!1!==strrpos(a,"=")){for(position=strrpos(a,"="),proceed=!0,"\\"==substr(a,position-1,1)&&(proceed=!1);!proceed;)substring=substr(a,0,position),position=strrpos(substring,"="),proceed=!0,"\\"==substr(a,position-1,1)&&(proceed=!1);value=trim(substr(a,position+1)),open=0,charv="",lastchar="";for(var e=0;e<strlen(value);e++)charv=substr(this.content,e,1),in_array(charv,c)&&"\\"!=lastchar?open++:in_array(charv,d)&&"\\"!=lastchar&&open--,lastchar=charv;0<open&&(b=!0)}return b},_stripDelimiter:function(a){for(var b=array_keys(this._delimiters),c=strlen(a),d=substr(a,0,1),e=substr(a,-1,1);in_array(d,b)&&e==this._delimiters[d];)a=substr(a,1,-1),d=substr(a,0,1),e=substr(a,-1,1);return a},_unwrap:function(a){return a=a.replace(/\s+/," "),trim(a)},_wordwrap:function(a){return""!=a&&is_string(a)&&(a=wordwrap(a,this._options.wordWrapWidth,this._options.wordWrapBreak,this._options.wordWrapCut)),a},_extractAuthors:function(a){a=this._unwrap(a);for(var b=a.split(" and "),c=0;c<b.length;c++){var d=trim(b[c]),e="",f="",g="",h="";if(!1===strpos(d,",")){var l=d.split(" |~"),m=l.length;if(1==m)g=l[0];else if(2==m)e=l[0],g=l[1];else{for(var n=!1,o=!1,p=0;p<m-1;p++)if(o)g+=" "+l[p];else if(!n){var q=this._determineCase(l[p]);this.isError(q)||(0==q?(n=!0,f+=" "+l[p]):e+=" "+l[p])}else if(q=this._determineCase(l[p]),this.isError(q));else if(0==q||-1==q){islast=!0;for(var r=p+1;r<m-1;r++)futurecase=this._determineCase(l[r]),this.isError(q)||0==futurecase&&(islast=!1);islast?(o=!0,-1==q?g+=" "+l[p]:f+=" "+l[p]):f+=" "+l[p]}else f+=" "+l[p];g+=" "+l[m-1]}}else{var l=[];l=explode(",",d);let a=[];if(a=explode(" ",l[0]),m=sizeof(a),1==m)g=a[0];else{o=!1;for(var p=0;p<m-1;p++)if(o)g+=" "+a[p];else if(0!=this._determineCase(a[p])){islast=!0;for(var r=p+1;r<m-1;r++)this._determineCase(a[r]),q=this._determineCase(a[r]),this.isError(q)||0==q&&(islast=!1);islast?(o=!0,g+=" "+a[p]):f+=" "+a[p]}else f+=" "+a[p];g+=" "+a[m-1]}3==l.length&&(h=l[1]),e=l[l.length-1]}b[c]={first:trim(e),von:trim(f),last:trim(g),jr:trim(h)}}return b},_determineCase:function(a){var b=-1,c=trim(a);if(is_string(a)&&0<strlen(c))for(var d=0,e=!1,f=0;!e&&d<=strlen(a);){var g=substr(c,d,1),h=ord(g);123==h&&f++,125==h&&f--,65<=h&&90>=h&&0==f?(b=1,e=!0):97<=h&&122>=h&&0==f?(b=0,e=!0):d++}else b=this.raiseError("Could not determine case on word: "+a);return b},isError:function(a){return"Object"==typeof a&&1==a.isError},_validateValue:function(a,b){a.match(/^{.*@.*}/)&&this._generateWarning("WARNING_AT_IN_BRACES",a,b),a.match(/^\".*\\".*\"/)&&this._generateWarning("WARNING_ESCAPED_DOUBLE_QUOTE_INSIDE_DOUBLE_QUOTES",a,b);for(var c=0,d="",e="",f=0;f<strlen(a);f++)e=substr(a,f,1),"{"==e&&"\\"!=d&&c++,"}"==e&&"\\"!=d&&c--,d=e;0!=c&&this._generateWarning("WARNING_UNBALANCED_AMOUNT_OF_BRACES",a,b)},_removeCurlyBraces:function(a){for(var b=array_keys(this._delimiters),c=substr(a,0,1),d=substr(a,-1,1),e="",f="";in_array(c,b)&&d==this._delimiters[c];)e+=c,f+=d,a=substr(a,1,-1),c=substr(a,0,1),d=substr(a,-1,1);return a=a.replace(/([^\\\\])\{(.*?[^\\\\])\}/,"12"),a=e+a+f,a},_generateWarning:function(a,b,c){"undefined"==typeof c&&(c="");var d={};d.warning=a,d.entry=b,d.wholeentry=c,this.warnings[this.warnings.length]=d},clearWarnings:function(){this.warnings=array()},hasWarning:function(){return!!(0<sizeof(this.warnings))},amount:function(){return sizeof(this.data)},_formatAuthor:function(a){return a.von=array_key_exists("von",a)?trim(a.von):"",a.last=array_key_exists("last",a)?trim(a.last):"",a.jr=array_key_exists("jr",a)?trim(a.jr):"",a.first=array_key_exists("first",a)?trim(a.first):"",ret=this.authorstring,ret=str_replace("VON",a.von,ret),ret=str_replace("LAST",a.last,ret),ret=str_replace("JR",a.jr,ret),ret=str_replace("FIRST",a.first,ret),trim(ret)},bibTex:function(){for(var a,b="",c=0;c<this.data.length;c++){for(key in a=this.data[c],b+="@"+strtolower(a.entryType)+" { "+a.cite+",\n",a){var d=a[key];0<this._options.wordWrapWidth&&(d=this._wordWrap(d)),in_array(key,array("cite","entryType","author"))||(b+="\t"+key+" = {"+d+"},\n")}if(!array_key_exists("author",a))author="";else if(this._options.extractAuthors){for(j in tmparray=[],a.author){var e=a.author[j];tmparray[tmparray.length]=this._formatAuthor(e)}author=join(" and ",tmparray)}else author=a.author;b+="\tauthor = {"+author+"}\n",b+="}\n\n"}return b},addEntry:function(a){this.data[this.data.length]=a},getStatistic:function(){for(var a,b=array(),c=0;c<this.data.length;c++)a=this.data[c],array_key_exists(a.entryType,b)?b[a.entryType]++:b[a.entryType]=1;return b},rtf:function(){for(var a,b="{\\rtf\n",c=0;c<this.data.length;c++){if(a=this.data[c],line=this.rtfstring,title="",journal="",year="",authors="",array_key_exists("title",a)&&(title=this._unwrap(a.title)),array_key_exists("journal",a)&&(journal=this._unwrap(a.journal)),array_key_exists("year",a)&&(year=this._unwrap(a.year)),array_key_exists("author",a))if(this._options.extractAuthors){for(var d in tmparray=[],a.author){var e=a.author[d];tmparray[tmparray.length]=this._formatAuthor(e)}authors=join(", ",tmparray)}else authors=a.author;""!=title||""!=journal||""!=year||""!=authors?(line=str_replace("TITLE",title,line),line=str_replace("JOURNAL",journal,line),line=str_replace("YEAR",year,line),line=str_replace("AUTHORS",authors,line),line+="\n\\par\n",b+=line):this._generateWarning("WARNING_LINE_WAS_NOT_CONVERTED","",print_r(a,1))}return b+="}",b},html:function(a,b){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=this.data.length);for(var c="<p>\n",d=a;d<b;d++){var e=this.data[d],f=this.htmlstring,g="",h="",k="",l="";if(array_key_exists("title",e)&&(g=this._unwrap(e.title)),array_key_exists("journal",e)&&(h=this._unwrap(e.journal)),array_key_exists("year",e)&&(k=this._unwrap(e.year)),array_key_exists("author",e))if(this._options.extractAuthors){for(j in tmparray=[],e.author){var m=e.author[j];tmparray[tmparray.length]=this._formatAuthor(m)}l=join(", ",tmparray)}else l=e.author;""!=g||""!=h||""!=k||""!=l?(f=str_replace("TITLE",g,f),f=str_replace("JOURNAL",h,f),f=str_replace("YEAR",k,f),f=str_replace("AUTHORS",l,f),f+="\n",c+=f):this._generateWarning("WARNING_LINE_WAS_NOT_CONVERTED","",print_r(e,1))}return c+="</p>\n",c}};export const bibtexify=(a,b)=>{var c=a=>a?(a=a.replace(/\\"\{a\}/g,"&auml;").replace(/\{\\aa\}/g,"&aring;").replace(/\\aa\{\}/g,"&aring;").replace(/\\"a/g,"&auml;").replace(/\\"\{o\}/g,"&ouml;").replace(/\\'e/g,"&eacute;").replace(/\\'\{e\}/g,"&eacute;").replace(/\\'a/g,"&aacute;").replace(/\\'A/g,"&Aacute;").replace(/\\"o/g,"&ouml;").replace(/\\"u/g,"&uuml;").replace(/\\ss\{\}/g,"&szlig;").replace(/\{/g,"").replace(/\}/g,"").replace(/\\&/g,"&").replace(/--/g,"&ndash;"),a):"",d={entry2html(a,b){var e=a.entryType.toLowerCase();-1===array_keys(d).indexOf(e)&&(e="misc",a.entryType=e);var f=c(d[e](a));return f+=d.links(a),f+=d.bibtex(a),b.options.tweet&&a.url&&(f+=d.tweet(a,b)),f.replace(/undefined[,.]?/g,"")},authors2html(a){var b,d="";if(!a)return d;for(var e=0;e<a.length;e++)0<e&&(d+=", "),b=a[e],d+=b.first+(b.von?" "+b.von+" ":" ")+b.last;return c(d)},links(a){var b="";return a.url&&a.url.match(/.*\.pdf/)?b+=" (<a title=\"PDF-version of this article\"  target=\"_blank\" href=\""+a.url+"\">pdf</a>)":a.url&&(b+=" (<a title=\"This article online\" target=\"_blank\" href=\""+a.url+"\">link</a>)"),b},bibtex(){},tweet(){},inproceedings(a){return this.authors2html(a.author)+" ("+a.year+"). "+a.title+". In <em>"+a.booktitle+", pp. "+a.pages+(a.address?", "+a.address:"")+".</em>"},incollection(a){return this.authors2html(a.author)+" ("+a.year+"). "+a.title+". In "+(a.editor?""+this.authors2html(a.editor)+", editor, ":"")+"<em>"+a.booktitle+", pp. "+a.pages+(a.address?", "+a.address:"")+".</em>"},article(a){return this.authors2html(a.author)+" ("+a.year+"). "+a.title+". <em>"+a.journal+", "+a.volume+(a.number?"("+a.number+")":"")+", pp. "+a.pages+". "+(a.address?a.address+".":"")+"</em>"},misc(a){return this.authors2html(a.author)+" ("+a.year+"). "+a.title+". "+(a.howpublished?a.howpublished+". ":"")+(a.note?a.note+".":"")},mastersthesis(a){return this.authors2html(a.author)+" ("+a.year+"). "+a.title+". "+a.type+". "+a.organization+", "+a.school+"."},techreport(a){return this.authors2html(a.author)+" ("+a.year+"). "+a.title+". "+a.institution+". "+a.number+". "+a.type+"."},book(a){return this.authors2html(a.author||a.editor)+" ("+a.year+").  <em>"+a.title+"</em>, "+a.publisher+", "+a.year+(a.issn?", ISBN: "+a.issn+".":".")},inbook(a){return this.authors2html(a.author)+" ("+a.year+"). "+a.chapter+" in <em>"+a.title+"</em>, "+(a.editor?" Edited by "+this.authors2html(a.editor)+", ":"")+a.publisher+", pp. "+a.pages+""+(a.series?", <em>"+a.series+"</em>":"")+(a.volume?", Vol. "+a.volume+"":"")+(a.issn?", ISBN: "+a.issn+"":"")+"."},proceedings(a){return this.authors2html(a.editor)+", editor(s) ("+a.year+").  <em>"+a.title+".</em>"+(a.volume?", Vol. "+a.volume+"":"")+(a.address?", "+a.address:"")+". "+(a.organization?+a.organization:"")+(a.organization&&a.publisher?", ":"")+(a.publisher?a.publisher+". ":"")+(a.note?a.note:"")},importance:{TITLE:9999,misc:0,manual:10,techreport:20,mastersthesis:30,inproceedings:40,incollection:50,proceedings:60,conference:70,article:80,phdthesis:90,inbook:100,proceedings:105,book:110,unpublished:120},labels:{article:"Journal",book:"Book",conference:"Conference",inbook:"Book chapter",incollection:"In Collection",inproceedings:"Conference",manual:"Manual",mastersthesis:"Thesis",misc:"Misc",phdthesis:"PhD Thesis",proceedings:"Conference proceeding",techreport:"Technical report",unpublished:"Unpublished"}};d.phdthesis=d.mastersthesis,d.conference=d.inproceedings;var e,f=function(a,b,c){this.options=c,this.miArray=b,this.stats={},this.initialize(a)},g=f.prototype;return g.initialize=function(a){var b=new BibTex;b.content=a,b.parse();for(var c,f=[],g=b.data.length,h={},i=0;i<g;i++){c=b.data[i],c.year||(c.year=this.options.defaultYear||"To Appear");try{var k=d.entry2html(c,this);f.push([c.year,d.labels[c.entryType],k]),h[d.labels[c.entryType]]=c.entryType}catch(a){console.error("Failed to process entry: ",c)}}e=getContent(f)},new f(a,b,{}),e};function getContent(a){function b(a){for(var b=[],c=0;c<a.length;c++)2==c&&b.push(a[c]);return b}for(var c=[],d=0;d<a.length;d++)c.push("<pre>&#13;</pre><div>"+b(a[d])+"</div>");return c}